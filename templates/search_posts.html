{% extends "base.html" %}

{% block body_contents %}
<div class="container">

<div class="mdl-card mdl-shadow--2dp" style="width:100%; min-height:20px; margin-bottom:20px; padding:20px">
    <form action="/search/posts" method="get">
        <div class="form-group row">
            <div class="col-10">
               <input type="text" name="q" class="form-control form-control-lg" id="lgFormGroupInput" autofocus placeholder="Search For Posts in your Feeds" value="{{ query }}">
            </div>
            <div class="col-2">
                <button type="submit" class="btn btn-primary" style="width:100%; height:100%">Search Posts</button>
            </div>
        </div>
    </form>
</div>

{% if query %}
<div class="mdl-card mdl-shadow--2dp" style="width:100%">
    <div style="padding: 40px">
        <h2> {{ results|length }} posts found - "{{ query }}" </h2><hr>
            {% for post in results %}
            <div class="mdl-card mdl-shadow--2dp" style="width:100%; padding: 40px; margin-bottom:40px">
            <div class="row">
                <div class="comments col-md-9" id="comments">
                    <!-- post -->
                    <div class="comment mb-2 row">
                        <div class="comment-avatar col-md-1 col-sm-2 text-center pr-1">
                            <a href="">
                                <img class="mx-auto rounded-circle img-fluid" 
                                src="{{ GetProfilePic(post.content._from) }}" 
                                alt="avatar"></a>
                        </div>
                        <div class="comment-content col-md-11 col-sm-10">
                            <h6 class="small comment-meta"><a href="/profile/{{ post.content._from }}">{{ getdetails(post.content._from).full_name }}</a> {{ parseTime(post.content.time) }}</h6>
                            <div class="comment-body">
                                {% if post.content.message %}                        
                                <p>
                                    {{ ParseMessage(post.content.message)|safe }}
                                    <br>
                                </p>
                                {% endif %}
                                
                            </div>
                        </div>
                            
                        <!-- comment is indented -->
                        {% for comment in post.comments %}
                        <div class="comment-reply col-md-11 offset-md-1 col-sm-10 offset-sm-2">
                            <div class="row">
                                <div class="comment-avatar col-md-1 col-sm-2 text-center pr-1">
                                    <a href=""><img class="mx-auto rounded-circle img-fluid" 
                                        src="{{ GetProfilePic(comment.content._from) }}" 
                                        alt="avatar"></a>
                                </div>
                                <div class="comment-content col-md-11 col-sm-10 col-12">
                                    <h6 class="small comment-meta"><a href="/profile/{{ comment.content._from }}">{{ getdetails(comment.content._from).full_name }}</a> {{ parseTime(comment.content.time) }}</h6>
                                    <div class="comment-body">
                                        {% if comment.content.message %}
                                        <p>{{ ParseMessage(comment.content.message)|safe  }}
                                            <br>
                                        </p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- reply is indented -->
                            {% for reply in comment.replies %}
                            <div class="comment-reply col-md-11 offset-md-1 col-sm-10 offset-sm-2">
                                <div class="row">
                                    <div class="comment-avatar col-md-1 col-sm-2 text-center pr-1">
                                        <a href=""><img class="mx-auto rounded-circle img-fluid"
                                            src="{{ GetProfilePic(reply.content._from) }}" 
                                            alt="avatar"></a>
                                    </div>
                                    <div class="comment-content col-md-11 col-sm-10 col-12">
                                        <h6 class="small comment-meta"><a href="/profile/{{ reply.content._from }}">{{ getdetails(reply.content._from).full_name }}</a> {{ parseTime(reply.content.time) }}</h6>
                                        <div class="comment-body">
                                            {% if post.content.message %}
                                            <p>{{ ParseMessage(reply.content.message)|safe }}
                                                <br>
                                            </p>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>                                
                            {% endfor %}                            
                            <!-- /reply is indented -->



                        </div>
                        {% endfor %}                            
                        <!-- /comment is indented -->

                    </div>

                </div>            
            </div>
            </div>
            {% endfor %}

    </div>
</div>
{% endif %}

</div>
{% endblock %}